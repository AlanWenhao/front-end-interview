# 星期三面试题

## 第一周 单页路由与权限问题
> 一个单页面应用，有6张页面，F、E、A、B、C、D。 页面ABCD构成了一个冗长的用户验证过程。目前A、B、C对应用户验证过程的第1步，第2步，第3步。 页面F是首页，E是某张业务相关页面。用户到达页面E后，系统发现用户没有认证，触发验证流程，到达页面A，然后开始A->B->C->D流程。 页面D是验证结果页面（验证成功页面）。 请问，如果到达页面D后，如何让用户点击返回可以返回页面F，而忽略中间流程（注：用户可能根本没有到达过F，比如微信分享直接进入了E）。  

### 我的回答
```
每次进入页面前检察权限，决定是否replace，但是这样第一个页面后退就会失效，变成循环往复的replace，而且replace在网速不行的时候会有闪屏
```

### 答案
```
答案： 这个问题初一看是对单页面路由架构的考察。也是一个很好的引入问题，可以考察非常多方面。 比如说：如何实现页面切换动画？ A、B、C都是表单的话，如何缓存用户输入完成的表单数据？……回到问题，因为history api提供了push/pop/replace三种操作，无论是其中的任何一种都无法实现上述的效果。 一个路由系统，首先要监听浏览器地址的变化，然后根据变化渲染不同的页面。1. 在页面到达D后，关闭对路由变化页面渲染的监听。 2. 路由系统要进行多次POP，可以用history.go(-n)实现； 3. 路由栈清空到只剩下一张页面时，将这张页面替换为F。 4. PUSH一张页面D。 5. 如果在HTML上有一个类似「轮播图」的设计，就是每一张页面是一张轮播图，将轮播图设置成只有「F」和「D」。 5. 恢复路由监听。 这个问题的另一个考点是，在上述完整的计算过程当中，需要知道当前历史记录中的页面数，页面数可以通过localStorage实现，在ls中维护一个变量，每次push的时候+1，并写入history.state。 POP的时候读取history.state将变量重置。
```

----

## 第二周

> CSRF攻击是什么，如何防范

### 答案 CSRF
```
1、周五公开课
2、CSRF 跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。[1] 跟跨網站指令碼（XSS）相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。
简单点说，CSRF 就是利用用户的登录态发起恶意请求。
3、如果接口是 Post 提交的，就相对麻烦点，需要用表单来提交接口
4、如何攻击 假设网站中有一个通过 Get 请求提交用户评论的接口，那么攻击者就可以在钓鱼网站中加入一个图片，图片的地址就是评论接口
5、如何防御 防范 CSRF 可以遵循以下几种规则：
Get 请求不对数据进行修改
不让第三方网站访问到用户 Cookie
阻止第三方网站请求接口
请求时附带验证信息，比如验证码或者 token
#SameSite
可以对 Cookie 设置 SameSite 属性。该属性设置 Cookie 不随着跨域请求发送，该属性可以很大程度减少 CSRF 的攻击，但是该属性目前并不是所有浏览器都兼容。
#验证 Referer
对于需要防范 CSRF 的请求，我们可以通过验证 Referer 来判断该请求是否为第三方网站发起的。
#Token
服务器下发一个随机 Token（算法不能复杂），每次发起请求时将 Token 携带上，服务器验证 Token 是否有效。
```

## 第三周 https与代理
> https抓包的原理是什么

### 答案
```
关键点：
1、https经历的非对称加密与对称加密，这道题实际考察的是https加密原理，参考crypto讲解加密一节
2、代理工具中客户端与服务端之间进行了拦截，相对于服务端，其再次伪造了客户端，但是需要客户端的证书

连接：https加密原理
http://www.wxtlife.com/2016/03/27/%E8%AF%A6%E8%A7%A3https%E6%98%AF%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E5%AE%89%E5%85%A8%E7%9A%84%EF%BC%9F/

https执行过程
1、服务端收到客户端请求后将公钥传回客户端
2、然后客户端验证公钥是否可信（预装来自公正机构的根证书来验证）
3、如果公钥可信，客户端会生成一个密码，用服务端公钥加密后返回服务端
4、服务端接收到由自己公钥加密的密码后，进行解密，然后两端用对称加密的方式传输
5、之后每次客户端发送请求都会生成新的对称加密的密码
抓包原理
1、基于以上抓包工具只有一种方式帮助抓包
2、抓包工具让客户端安装自己的证书，也就是它们伪装成一个https的服务端，当客户端项目标网站发送请求时，https请求先访问到了抓包工具，
3、之后抓包工具使用自己的公钥和私钥与目标网站再建立一个https的通信，于是抓包工具就变成了消息的中转站实现抓包
```
